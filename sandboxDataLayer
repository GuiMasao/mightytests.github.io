<script>
  function names() {
    var titles = document.querySelectorAll("div.product-container-itembox-description-title")
    var names = []
    for (var i = 0; i < titles.length; i++) {
      var text = titles[i].innerText
      var newline_pos = text.indexOf("\n")
      names.push(text.slice(0, newline_pos))
    }
    return names
  }

  function prices() {
    var prices = document.querySelectorAll("div.product-container-itembox-description-price")
    var arr = []
    for (var i = 0; i < prices.length; i++) {
      var price = prices[i].innerText
      arr.push(price.replace(/[^0-9\.-]+/g, ""))
    } 
    return arr
  }

  
  
  function ecommerce_impressions() {
    var product = {}
    var impressions = [{}]
    name_table = names()
    var price_table = prices()
    for (var i= 0; i < price_table.length; i++){
      product = {'id':1234+i , 'price': price_table[i], 'name': name_table[i], 'position':i+1}
      impressions.push(product)
    }
    impressions.splice(0,1)
    var ecommerce = {'currencyCode':'USD',impressions}
    return ecommerce
  }

  function ecommerce_start(){
    var ecommerce = ecommerce_impressions()
    dataLayer.push({event: 'eec.impressionView',ecommerce})
  }

</script>
